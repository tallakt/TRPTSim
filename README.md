# TRPT Simulator

This is a simulator for a particular kind of TRPT type. TRPT airborne wind
energy is a class of windmills that are airborne and where the power of the
flying part of the windmill is transferred using torquer transfer throuch a
tensile shaft. It means Tensile Rotary Power Transmission and was (described
first by Oliver
Tulloch)[https://pureportal.strath.ac.uk/en/publications/tensile-rotary-power-transmission-model-development-for-airborne-]

This particular class of TRPT consiste of a soft shaft (possibly with
compression rods) and a number of kites rotating in a single layer, connected
through a bridle, flying in a ring. And all the kites are of the same type.

To say what it isn't, no lifter kite is assumed, and the shaft is assumed to be
mostly pure tether and not very long. Also there is only one layer, so not
lower layers to expand the rotary shaft etc.

Why? Because these rigs are a simplest structure possible if the kite is very
controllable. So some kind of computer control of the kite during the loop is
assumed.

The simulator is intended for use with a stationary power plant as well as a
power source on a moving vehicle.


## Description of the simulation performed

The simulator is intended for quick prototyping of TRPT rigs without doing a
complete detailed simulation. So

- The shape of the layer is assumes constant and all bridle lines tensioned. It
  is a goal of the simulator though, to verify that all bridle lines are
  tensioned
- Tether drag is using a simplified model disregarding dynamics
- The roll of the kites is set directly, dynamics in roll are not accounted for
- Pitch is not modelled, it is assumed that we can set pitch to achieve the
  desired lift coeficcient as needed


## Install

In Julia, install from git with

```julia
pkg> add /path/to/TRPTSim#main
```

Then use with 

```julia
using TRPTSim
```

## Examples

First create a model/configuration

```julia
> cfg1 = ampyx_ap2()
> cfg2 = delft_lei_v3()
> cfg3 = eijkelhof()
> cfg4 = october_kite()
> cfg5 = wi_rigid_daisy()
```


Don't expect any detailed simulation. The models are coarse approximation based
on available data. And the kites are not optimized for this kind of TRPT
simulator.


You can convert a model to a `Dict` to allow Julia to pretty print the contents

```julia
> cfg |> config_to_dict
Dict{Symbol, Any} with 13 entries:
  :n              => 3
  :rho            => 1.225
  :gravity        => 9.81
  :elev           => 0.523599
  :l              => 6.7
  :safety_factor  => 3.0
  :c_d_tether     => 1.1
  :d              => 0.0012
  :s              => 0.2
  :design_c_l     => 0.635
  :c_d_fun_coeffs => [0.0148208, -0.0188157, 0.0381036, 0.0754882, 0.145568, -0.261428, -0.070654, 0.20734, -0.0597481]
  :m              => 0.42
  :radius         => 4.29
```

These values are what defines the kite parameters. To create a config with some
different parameters, do

```julia
> cfg = new_cfg = config(wi_rigid_daisy(), n = 6, l = 15.0)
```

Or modify a confuration by scaling it

```julia
> cfg = scale_to_area(wi_rigid_daisy(), 40.0)
```

The basic unit of simulation is the `solve` function. There is a second version
that is mostly more useful that wraps the result of the `solve` operation into
a `DataSet` for easier analysis.


```julia
> wind_speed = 12.0
> psi = 0.0
> m_t_factor = 1.0
> force_h = 0.0
> solution = solve_sector(cfg, wind_speed, psi, m_t_factor, force_h)
> (dataframe, solver_input) = solve_sector_df(cfg, wind_speed, psi, m_t_factor, force_h)
```

The inputs to the solver is some parameters that are not spesifically
configuration, but more things that would notmally change. Wind speed is a good
example. The inputs besides the configuration are

- `wind_speed`: The wind speed in m/s
- `psi`: the offset in azimuth relative to pointing the AWE rig directly downwind
- `m_t_factor`: The maximum moment that may be transferred for a given tension
  of the shaft. A number of 1.0 would be typical for any scale shaft, though
  the number depends on the length, radii, stiff rods etc of the rig and the
  twist of the shaft. The `m_t_factor` should scale approximately linearly with
  scale.
- `force_h`: the force generated by the implemented algorithm in a direction
  horizontal in the direction perpendicular to the shaft centerline.

Note that the `m_t_factor`, like almost all other parameters, is specified per
kite.

The `m_t_factor` also determines the induction factor. The maximum possible
value is determined by the shaft geometry, but one may opt to run the power
plant with a smaller `m_t_factor`. At this point, the simulator does not keep
track of the maximum possible `m_t_factor` for the actual shaft geometry. 


The flying speed may be estimated by this heuristic.  This is used to
initialize the solver with an initial flying speed.

```julia
> speed0 = heuristic_flying_speed(cfg, wind_speed, psi)
```

The optimal tension for a rig is estimated by iteration using. Optimal tension
is the tension that gives the maximum power output.

```julia
> tension = optimal_tension(cnf, wind_speed, psi, m_t_factor, force_h)
```

To calculate the maximal possible `m_t_factor` for a shaft section, use this
function. Note that the radius at either end is assumed to be maintained


```julia
> radius_1 = 1.0
> radius_2 = 4.3
> length = 8.0
> shaft_section_m_t_factor(radius_1, radius_2, length)
```

Once you have solved the kite motion, the solution can be plotted using

```julia
> plot_solution(dataframe, solver_input)
```

A complete power curve is made and plotted like this

```julia
> winds = 8:15
> pc = power_curve(cfg, winds, psi, m_t_factor, force_h)
> plot_power_curves(pc)
```

To plot many curves in one chart 

```julia
> plot_power_curves("First" => pc1, "Second" => pc2)
> plot_power_curves([Pair("$x", power_curve(cfg, winds, psi, x, force_h)) for x=0.2:0.4:1.2]...)
```


There is also a tension curve for mounting the windmill on a moving vessel

```julia
> plot_tension_curves(pc)
```











